name: "Setup Zarf"

on:
  pull_request:
    types: [assigned, opened, synchronize, reopened]
  push:
    branches:
      - main

jobs:
  setup-zarf:
    runs-on: ubuntu-latest
    name: Setup Zarf
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Zarf
        uses: ./
        with:
          download-init-package: true
          version: v0.22.2

      - name: Zarf Version
        run: zarf version

      - name: Create k3d Cluster
        run: |
          curl -s https://raw.githubusercontent.com/k3d-io/k3d/main/install.sh | bash
          k3d --version
          k3d cluster create

      - name: Zarf Init
        run: zarf init --confirm

      - name: Deploy DOS Games
        run: zarf package deploy sget://defenseunicorns/zarf-hello-world:$(uname -m) --confirm

      - name: List installed packages
        run: zarf package list
